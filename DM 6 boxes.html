<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Positioning</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #canvas {
            /* border: 5px solid #808080; */
            width: 3105px;
            height: 1734px;
            position: relative;
            margin: auto;
            background-color: rgb(248, 248, 248);
            transform-origin: top left;
        }
        .droppable {
            border: 1px solid #808080;
            position: absolute;
            overflow: hidden;
            cursor: pointer;
        }
        #textLabel {
            position: absolute;
            left: 228px;
            top: 150px;
            font-size: 25px;
            background-color: white;
            border: 1px solid black;
            padding: 5px;
            display: none;
        }
        #controlWrapper {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid black;
            display: inline-block;
            margin-top: 20px;
        }
        #textInput, #capture {
            font-size: 22px;
            margin: 5px;
        }
        .import-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #808080;
            font-weight: bold;
        }
        #dateContainer {
            position: absolute;
            top: 30px;
            left: 50px;
            font-size: 20px;
            font-family: Arial, sans-serif;
            color: #333;
        }
    </style>
</head>
<body>

<div id="canvas">
    <div id="dateContainer"></div>
    <div class="droppable" style="width:640px;height:360px;left:868px;top:139px;">
        <div class="import-text">Click & Import</div>
    </div>
    <div class="droppable" style="width:1280px;height:720px;left:228px;top:593px;">
        <div class="import-text">Click & Import</div>
    </div>
    <div class="droppable" style="width:800px;height:180px;left:228px;top:1413px;">
        <div class="import-text">Click & Import</div>
    </div>
    <div class="droppable" style="width:640px;height:360px;left:1601px;top:139px;">
        <div class="import-text">Click & Import</div>
    </div>
    <div class="droppable" style="width:1280px;height:720px;left:1601px;top:593px;">
        <div class="import-text">Click & Import</div>
    </div>
    <div class="droppable" style="width:800px;height:180px;left:2081px;top:1413px;">
        <div class="import-text">Click & Import</div>
    </div>
    <div id="textLabel"></div>
</div>

<div id="controlWrapper">
    <input type="text" id="textInput" placeholder="Enter text here">
    <input type="color" id="colorPicker" value="#ffffff">
    <button id="capture">Capture Image</button>
</div>

<input type="file" id="fileInput" style="display:none;" accept="image/*">

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(function() {
    var currentDroppable;

    // Update date immediately when the page loads
    function updateDate() {
        const dateContainer = document.getElementById("dateContainer");
        const currentDate = new Date();
        const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
        const dateString = currentDate.toLocaleDateString('en-US', options);
        dateContainer.textContent = dateString;
    }
    
    // Call updateDate immediately
    updateDate();
    
    // Update date every second to ensure accuracy
    setInterval(updateDate, 1000);

    $('.droppable').on('click', function() {
        currentDroppable = $(this);
        $('#fileInput').click();
    });

    $('#fileInput').on('change', function(event) {
        var file = event.target.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                var img = $('<img>').attr('src', e.target.result).css({width: '100%', height: '100%'});
                currentDroppable.empty().append(img);
            };
            reader.readAsDataURL(file);
        }
    });

    $('#colorPicker').on('input', function() {
        var color = $(this).val();
        $('#canvas').css('background-color', color);
        updateTextColorAndBorder(color);
    });

    $('#capture').on('click', function() {
        var text = $('#textInput').val();
        $('#textLabel').text(text).show();

        // Hide borders before capture
        $('.droppable').css('border', 'none');

        html2canvas(document.getElementById('canvas'), {
            width: 3105,
            height: 1734,
            scale: 1
        }).then(function(canvas) {
            $('#textLabel').hide();

            // Show borders after capture
            $('.droppable').css('border', '1px solid #808080');

            var link = document.createElement('a');
            link.href = canvas.toDataURL('image/jpeg');
            link.download = 'DM Approval_' + text + '.jpg';
            link.click();
        });
    });

    // Function to update text color and border color based on background color
    function updateTextColorAndBorder(hex) {
        var rgb = hexToRgb(hex);
        var brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000; // Calculate brightness
        var textColor = brightness > 125 ? '#333' : '#FFF'; // Use dark text for bright backgrounds, white text for dark backgrounds
        var borderColor = brightness > 125 ? '#333' : '#FFF'; // Inverse logic for border
        $('#dateContainer').css('color', textColor);
        $('#canvas').css('border-color', borderColor);
    }

    // Convert hex color to RGB
    function hexToRgb(hex) {
        var bigint = parseInt(hex.slice(1), 16);
        return {
            r: (bigint >> 16) & 255,
            g: (bigint >> 8) & 255,
            b: bigint & 255
        };
    }
});
</script>

</body>
</html>